<!DOCTYPE html>
<html lang="es">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="application-name" content="Agility Contest's Serial Chronometer Web Console" />
    <meta name="copyright" content="Â© 2019 Juan Antonio Martinez" />
    <meta name="author" lang="en" content="Juan Antonio Martinez" />
    <title>Now Running Web console</title>
    <script src="jquery-2.2.4.min.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" type="text/css" href="toogle-switch.css" />
    <style type="text/css">
        .input_number {
            width:50px;
            display:inline-block;
            padding:10px 0px 10px 0px;
        }
        .chrono_fondo {
            border: 5px solid black;
            border-radius: 10px;
        }
        .title {
            color: white;
            text-align:right;
            font-style: italic;
            font-weight: bold;
        }
        .display {
            font-family: monospace;
            text-align: center;
            font-weight: bold;
            font-size: 12.5vw;
        }
    </style>
    <script type="text/javascript">
        function doLayout(dg,id,x,y,w,h) {
            var elem=$(id);
            elem.css('display','inline-block');
            elem.css('position','absolute');
            elem.css('float','left');
            // elem.css('padding','5px');
            elem.css('-webkit-box-sizing','border-box');
            elem.css('-moz-box-sizing','border-box');
            elem.css('box-sizing','border-box');
            elem.css('left',  ((25+x*100)/dg.cols)+'%');
            elem.css('top',   ((100+y*100)/dg.rows)+'%');
            elem.css('width', ((w*100)/dg.cols)+'%');
            elem.css('height',((h*100)/dg.rows)+'%');
            // elem.css('line-height',((h*100)/dg.rows)+'%');
            // elem.css('vertical-align','bottom');
        }

        function initialize() {
            $('#btn_turno').prop('checked',true);
            $('#sel_rec').val("0").prop('enabled',true);
            readData();
            setInterval(function() {readData();},5000);
            var layout= {'rows':55,'cols':145};
            doLayout(layout,"#Logo",7,5,20,10);
            doLayout(layout,"#Copyright",35,3,107,3);
            doLayout(layout,"#Banner",35,5,107,5);
            doLayout(layout,"#fondo_clock",34,14,62,27);
            doLayout(layout,"#Clock",35,15,60,25);
            doLayout(layout,"#fondo_datos",99,14,43,27);
            doLayout(layout,"#FaltasLbl",103,17,10,5);
            doLayout(layout,"#Faltas",115,16,5,5);
            doLayout(layout,"#FaltasUp",122,16,8,5);
            doLayout(layout,"#FaltasDown",132,16,8,5);
            doLayout(layout,"#RehusesLbl",103,27,10,5);
            doLayout(layout,"#Rehuses",115,25,5,5);
            doLayout(layout,"#RehusesUp",122,25,8,5);
            doLayout(layout,"#RehusesDown",132,25,8,5);
            doLayout(layout,"#EliminadoLbl",103,36,10,5);
            doLayout(layout,"#Eliminado",115,34,5,5);
            doLayout(layout,"#EliminadoUp",122,34,8,5);
            doLayout(layout,"#EliminadoDown",132,34,8,5);
            doLayout(layout,"#fondo_info",4,26,27,15);
            doLayout(layout,"#RingLbl",8,29,10,5);
            doLayout(layout,"#Ring",19,28,10,5);
            doLayout(layout,"#TurnoLbl",8,35,10,5);
            doLayout(layout,"#Turno",19,34,10,5);
            doLayout(layout,"#fondo_buttons",4,44,138,7);
            doLayout(layout,"#ResetBtn",5,45,15,5);
            doLayout(layout,"#StartBtn" ,25,45,15,5);
            doLayout(layout,"#IntBtn",45,45,15,5);
            doLayout(layout,"#StopBtn",65,45,15,5);
            doLayout(layout,"#SalidaBtn",106,45,15,5);
            doLayout(layout,"#ReconocimientoBtn",126,45,15,5);
        }

        function readData() {
            $.ajax({
                url: '/readData',
                dataType: 'json',
                method: 'GET',
                data: { 'Operation':'readData' }, // not really needed, but...
                success: function(data){
                    $('#Faltas').val(data.F);
                    $('#Rehuses').val(data.R);
                    $('#Eliminado').val(data.E);
                    $('#Turno').val(data.D);
                    // if any event, parse it
                },
                error: function(){
                    alert('Error');
                }
            });
            return false;
        }

        function sendPost(url) {
            $.ajax({
                type: 'POST',
                url: url,
                dataType: 'json',
                data: $('#parameters').serialize()
            }).done(function(data) {
                // alert(JSON.stringify(data));
            }).fail(function(data) {
                alert("Error");
            });
            $('#sel_stop').val("0");
        }
        function writeData() {
            sendPost('/writeData');
        }

        function falta(val) { writeData(); }
        function rehuse(val) { writeData(); }
        function eliminado(val) { writeData(); }
        function reset(obj) { writeData(); }
        function start_run(obj) { writeData(); }
        function int_run(obj) { writeData(); }
        function stop_run(obj) { writeData(); }
        function reconocimiento() {}
        function salida() { }

    </script>
</head>
<body onload="initialize();" style="background:blue">
<div style="width:100%">

    <form id="parameters" autocomplete="off">
    <!-- entrada oculta para componer comandos -->
    <input type="hidden" name="message" id="message" value=""/>
        <!-- logotipo -->
    <label id="Logo" name="Logo" class="logo"><a target="info" href="/getInfo"><img src="/AgilityContest.png" alt="logo" width="100%"></a></label>
        <!-- titulo de cabecera -->
    <label id="Banner" class="title" for="Clock" class="title"><h2>AgilityContest Serial Chronometer Web Interface</h2></label>
        <!-- ventana del reloj -->
    <span class="chrono_fondo" style="background: red;"id="fondo_clock">&nbsp;</span>
    <a target="clock" href="/clock" >
        <input id="Clock" class="display" type="text" readonly="readonly" name="Clock" value="43:21">
    </a>
        <!-- ventana de faltas y rehuses -->
        <span class="chrono_fondo " id="fondo_datos" style="background: #87CEEB">&nbsp;</span>
    <label id="FaltasLbl" for="Faltas" class="data">Faltas:</label>
    <input id="Faltas"  class="data" type="text" readonly="readonly" name="F" value="Faltas">
    <input id="FaltasUp" class="data" type="button" name="FaltasUp" value="Flt+" onclick="falta(1)"/>
    <input id="FaltasDown"  class="data" type="button" name="FaltasDown" value="Flt-" onclick="falta(-1)">
    <label id="RehusesLbl" for="Rehuses" class="data">Rehuses:</label>
    <input id="Rehuses"  class="data" type="text" readonly="readonly" name="R" value="Rehuses">
    <input id="RehusesUp" class="data" type="button" name="RehusesUp" value="Reh+" onclick="rehuse(1);"/>
    <input id="RehusesDown"  class="data" type="button" name="RehusesDown" value="Reh-" onclick="rehuse(-1);">
    <label id="EliminadoLbl" for="Eliminado" class="data">Eliminado:</label>
    <input id="Eliminado"  class="data" type="text" readonly="readonly" name="F" value="Eliminado">
    <input id="EliminadoUp" class="data" type="button" name="EliminadoUp" value="El+" onclick="eliminado(1);"/>
    <input id="EliminadoDown"  class="data" type="button" name="EliminadoDown" value="El-" onclick="eliminado(-1);">

    <!-- ventana de turno y ring -->
        <span class="chrono_fondo " id="fondo_info" style="background: #87CEEB">&nbsp;</span>
    <label id="TurnoLbl" for="Turno" class="data">En pista:</label>
    <input id="Turno"  class="data" type="text" readonly="readonly" name="Turno" value="Turno">
    <label id="RingLbl" for="Ring" class="data">Ring:</label>
    <input id="Ring"  class="data" type="text" readonly="readonly" name="Ring" value="Ring">

    <!-- botonera de abajo -->
        <span class="chrono_fondo" id="fondo_buttons" style="background:#a6ff7c">&nbsp;</span>
    <input id="ResetBtn" class="data" type="button" name="Reset" value="Reset" onclick="reset();"/>
    <input id="StartBtn" class="data" type="button" name="Start" value="Start" onclick="start_run();"/>
    <input id="IntBtn" class="data" type="button" name="Intermediate" value="T. Int." onclick="int_run();"/>
    <input id="StopBtn" class="data" type="button" name="Stop" value="Stop" onclick="stop_run();"/>
    <input id="SalidaBtn" class="data" type="button" name="Salida" value="15 Secs." onclick="salida();"/>
    <input id="ReconocimientoBtn" class="data" type="button" name="CourseWalk" value="CourseWalk" onclick="reconocimiento();"/>
    </form>
</div>
<span id="Copyright" style="color:white;width:100%;display:block;text-align:right;font-style:italic;font-size:10px"><br/>Copyright &copy; 2019 by JAMC para AgilityContest 3.9.1</span>
</body>
</html>
